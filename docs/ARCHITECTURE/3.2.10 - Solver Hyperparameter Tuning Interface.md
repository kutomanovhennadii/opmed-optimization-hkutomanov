\## 3.2.10 - Solver Hyperparameter Tuning Interface (tune\_solver.py)



\### Purpose

This module automates experimentation with solver-level hyperparameters that influence CP-SAT search performance.

It extends the orchestration layer by executing multiple runs of `run.py` under different solver configurations,

collecting metrics, aggregating results, and identifying the most effective solver settings.



---



\### Function Signature

tune\_solver(

base\_config: Path,

surgeries\_path: Path,

search\_space\_path: Path,

output\_dir: Path

) -> SolverTuningReport



yaml

Копировать код



---



\### Description

`tune\_solver` runs systematic tests of solver heuristics and resource constraints.

Each experiment modifies `cfg.solver` fields such as search strategies, time limits, conflict thresholds, and precision gaps.

The goal is to minimize runtime while preserving feasibility and solution quality.



---



\### Search Space Parameters



\#### 1. Branching and Heuristic Controls

| Parameter | Type / Values | Description |

|------------|----------------|-------------|

| search\_branching | str: `AUTOMATIC`, `FIXED\_SEARCH`, `PORTFOLIO\_SEARCH`, `LP\_SEARCH` | Main search strategy |

| random\_seed | int | Random seed for reproducibility |

| use\_optional\_variables | bool | Include optional intervals in search heuristics |

| search\_randomization\_tolerance | float \[0–1] | Degree of randomization in search order |



\#### 2. Local Decision Strategies (optional)

When `use\_custom\_strategy = True`, a set of manual decision strategies can be injected:

model.AddDecisionStrategy(

variables=\[x, y, z],

var\_strategy=cp\_model.CHOOSE\_LOWEST\_MIN,

domain\_strategy=cp\_model.SELECT\_MIN\_VALUE

)



python

Копировать код

`var\_strategy` ∈ {CHOOSE\_FIRST, CHOOSE\_LOWEST\_MIN, CHOOSE\_HIGHEST\_MAX, CHOOSE\_MAX\_DOMAIN\_SIZE, CHOOSE\_MIN\_DOMAIN\_SIZE}

`domain\_strategy` ∈ {SELECT\_MIN\_VALUE, SELECT\_MAX\_VALUE, SELECT\_LOWER\_HALF, SELECT\_UPPER\_HALF}



\#### 3. Resource Limits

| Parameter | Type | Description |

|------------|------|-------------|

| max\_time\_in\_seconds | float | Wall-clock time limit |

| max\_num\_conflicts | int | Limit of CDCL conflicts |

| max\_num\_branches | int | Limit of decision branches |

| max\_memory\_in\_mb | int | Memory usage cap |

| max\_delta | float | Minimum improvement threshold for continued search |



\#### 4. Precision and Stopping Criteria

| Parameter | Type | Description |

|------------|------|-------------|

| relative\_gap\_limit | float | Stop when relative gap ≤ threshold |

| absolute\_gap\_limit | float | Stop when absolute gap ≤ threshold |

| stop\_after\_first\_solution | bool | Halt after first feasible solution |

| stop\_after\_presolve | bool | Stop after presolve (diagnostic mode) |



\#### 5. Presolve and Linearization

| Parameter | Type | Description |

|------------|------|-------------|

| cp\_model\_presolve | bool | Enable or disable presolve |

| linearization\_level | int (0–2) | Aggressiveness of linearization |

| add\_lp\_constraints\_lazily | bool | Lazy addition of LP constraints |

| use\_sat\_inprocessing | bool | Allow SAT-level clause simplification |



---



\### Contracts



\*\*Preconditions\*\*

\- `base\_config` and `surgeries\_path` point to valid inputs for `run.py`.

\- `search\_space\_path` defines valid solver parameters and value ranges.

\- OR-Tools CP-SAT solver environment available.



\*\*Postconditions\*\*

\- For each parameter combination, a run is executed via `run.py`.

\- Output directory structure:

output\_dir/<param\_set\_id>/run\_<timestamp>/

├─ solution.csv

├─ metrics.json

├─ solver.log

└─ validation\_report.json



markdown

Копировать код

\- Aggregated report files:

\- `summary\_metrics.jsonl` — all runs’ raw metrics

\- `solver\_tuning\_report.json` — aggregated averages and rankings

\- `recommended\_solver\_config.yaml` — best-performing configuration



\*\*Errors\*\*

\- `TuningError`: malformed search space or failed experiment series.

\- `IOError`: inability to read/write intermediate results.

\- `SolveError`: propagated if solver consistently fails.



---



\### Aggregation and Analysis



The module performs:

1\. Parsing all `metrics.json` files from completed runs.

2\. Grouping by parameter configuration.

3\. Computing average and standard deviation of:

&nbsp;- `runtime\_sec`, `total\_cost`, `relative\_gap`, `solver\_status` distribution.

4\. Ranking parameter sets by optimization criterion (e.g., `minimize runtime\_sec` with `valid=True`).

5\. Producing a consolidated report:



{

"best\_config": {

"search\_branching": "PORTFOLIO\_SEARCH",

"relative\_gap\_limit": 0.02,

"max\_time\_in\_seconds": 60

},

"criteria": "minimize runtime\_sec with valid=True",

"datasets\_tested": 3,

"avg\_runtime\_sec": 22.4,

"avg\_relative\_gap": 0.015,

"timestamp": "2025-10-30T18:40:00"

}



yaml

Копировать код



---



\### Integration

| Stage | Role |

|--------|------|

| run.py | Executes single run with given solver parameters |

| tune\_solver.py | Performs multi-run experiments and aggregates results |

| metrics.json | Source of solver performance data |

| solver\_tuning\_report.json | Final summary with aggregated scores |

| recommended\_solver\_config.yaml | Output configuration for production use |



---



\### Summary

The Solver Hyperparameter Tuning module enables empirical optimization of CP-SAT solver parameters.

It automates the exploration of branching strategies, resource limits, and precision thresholds,

collects and averages performance metrics, and generates human- and machine-readable recommendations

for optimal solver configurations.

"@ | Out-File -Encoding ascii ".\\ARCHITECTURE.md" -Appen
