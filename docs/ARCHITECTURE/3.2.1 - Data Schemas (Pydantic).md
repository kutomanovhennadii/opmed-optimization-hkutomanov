\\## 3.2.1 - Data Schemas (Pydantic)







\\### Purpose



This section defines the internal Pydantic data models used throughout the Opmed optimization framework.  



These models provide strong typing, validation, and reproducible data exchange between modules:



DataLoader, SolverCore, Optimizer, Validator, and Visualizer.







\\### Overview



All data models follow the ISO-8601 datetime standard with explicit timezone (default: UTC).  



For computation, timestamps are converted into integer ticks using the time unit from config.yaml.







Conversion rule:



tick = round((timestamp - day\\\_start) / delta\\\_t)







Default delta\\\_t = 0.0833 hours (5 minutes).  



This discretization ensures reproducibility and integer-based time reasoning for CP-SAT.







---







\\### Model: Surgery



Represents one surgery record loaded from surgeries.csv.







| Field | Type | Required | Description |



|--------|------|----------|-------------|



| surgery\\\_id | str | yes | Unique identifier of the surgery |



| start\\\_time | datetime (UTC) | yes | Start timestamp |



| end\\\_time | datetime (UTC) | yes | End timestamp |



| duration | float (hours) | optional | Computed if missing |



| room\\\_hint | str | optional | Preferred operating room |







Validation rules:



\\- end\\\_time must be greater than start\\\_time



\\- duration = (end\\\_time - start\\\_time) in hours



\\- all times include explicit timezone



\\- converted to integer ticks for solver







---







\\### Model: Config



Represents full solver configuration validated from config.yaml.







| Field | Type | Default | Description |



|--------|------|----------|-------------|



| time\\\_unit | float | 0.0833 | Tick size in hours (5 minutes) |



| rooms\\\_max | int | 20 | Number of operating rooms |



| shift\\\_min | float | 5 | Minimum shift length in hours |



| shift\\\_max | float | 12 | Maximum shift length in hours |



| shift\\\_overtime | float | 9 | Threshold for overtime pay |



| overtime\\\_multiplier | float | 1.5 | Overtime cost factor |



| buffer | float | 0.25 | Room switch buffer in hours |



| utilization\\\_target | float | 0.8 | Minimum efficiency requirement |



| enforce\\\_surgery\\\_duration\\\_limit | bool | True | Reject surgeries longer than 12h |



| timezone | str | UTC | Used for datetime parsing |



| solver.search\\\_branching | str | AUTOMATIC | CP-SAT search mode |



| solver.num\\\_workers | int | 4 | Number of threads |



| solver.max\\\_time\\\_in\\\_seconds | int | 60 | Time limit for solver |



| solver.random\\\_seed | int | 0 | Random seed for reproducibility |







Validation rules:



\\- 5 <= shift\\\_min < shift\\\_max <= 12



\\- buffer > 0



\\- all floats must be positive



\\- solver parameters must be valid for CP-SAT







---







\\### Model: SolutionRow



Represents one record from solution.csv produced by the optimizer.







| Field | Type | Required | Description |



|--------|------|----------|-------------|



| surgery\\\_id | str | yes | Must match input surgery |



| start\\\_time | datetime (UTC) | yes | Scheduled start |



| end\\\_time | datetime (UTC) | yes | Scheduled end |



| anesthetist\\\_id | str | yes | Assigned anesthesiologist |



| room\\\_id | str | yes | Assigned operating room |







Validation rules:



\\- no overlapping intervals per anesthetist\\\_id or room\\\_id



\\- buffer >= 15 minutes between room changes



\\- start\\\_time and end\\\_time must include timezone



\\- file output sorted by anesthetist\\\_id and start\\\_time







---







\\### Timezone and Discretization



\\- All datetime values are stored as timezone-aware UTC objects.



\\- For solver logic, they are converted to integer ticks using delta\\\_t.



\\- Default delta\\\_t = 5 minutes; configurable via Config.time\\\_unit.



\\- Conversion functions:



\&nbsp; - to\\\_ticks(dt) -> int



\&nbsp; - to\\\_datetime(ticks) -> datetime







---







\\### Summary



These schemas ensure consistent structure and validation across all modules.  



They define the single source of truth for data representation in the Opmed system and serve as the contract between ETL, solver, and reporting layers.



