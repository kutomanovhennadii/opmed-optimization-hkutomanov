\## 3.2.4 - Optimizer Interface



\### Purpose

The Optimizer module executes the CP-SAT solver on a model bundle constructed by ModelBuilder.

It controls solver parameters, applies time and resource limits, collects metrics, logs results, and returns a structured SolveResult object.

Its purpose is to provide a deterministic and reproducible optimization layer for all experiment runs.



---



\### Function Signature

solve(bundle: CpSatModelBundle, cfg: Config) -> SolveResult





---



\### SolveResult Structure

`SolveResult = { status, objective, assignments, logs, metrics }`



| Key | Type | Description |

|------|------|-------------|

| status | str | Final solver state (see Status Automaton) |

| objective | float | Final objective value (e.g., total anesthesiologist cost) |

| assignments | dict | Surgery assignments: {surgery\_id -> {anesthetist\_id, room\_id}} |

| logs | list\[str] | Full solver log lines, including timestamps and key events |

| metrics | dict | Quantitative summary of solver performance |



---



\### Contracts



\*\*Preconditions\*\*

\- `bundle` is a valid CpSatModelBundle created by ModelBuilder.

\- `cfg` contains a valid solver configuration (`num\_workers`, `max\_time\_in\_seconds`, `random\_seed`, etc.).

\- Output directories for metrics and logs are accessible and writable.



\*\*Postconditions\*\*

\- Returns a fully populated `SolveResult` object.

\- All numeric metrics and solver parameters are recorded.

\- Logs include solver status, runtime, and configuration snapshot.

\- Re-running with the same seed and configuration yields identical `SolveResult.status` and `SolveResult.objective`.



\*\*Errors\*\*

\- `SolveError`: unexpected solver failure, infeasibility due to invalid model.

\- `ConfigError`: invalid or missing solver parameter.

\- `IOError`: unable to write logs or metrics.



---



\### Status Automaton

Each solver run terminates in exactly one of four possible states.



| Status Code | Meaning | Transition Conditions |

|--------------|----------|-----------------------|

| \*\*INFEASIBLE\*\* | No valid solution exists. | Model proven inconsistent or solver reached conflict limit. |

| \*\*FEASIBLE\*\* | Valid but non-optimal solution found. | Solver reached time or resource limit before optimality proof. |

| \*\*OPTIMAL\*\* | Proven globally optimal solution. | Solver finished full search and verified optimal bound. |

| \*\*UNKNOWN\*\* | Terminated without conclusive state. | External interruption or incomplete data returned. |



\*\*Transition Graph\*\*

INIT -> FEASIBLE -> OPTIMAL

INIT -> INFEASIBLE

INIT -> UNKNOWN



Only one terminal state is allowed per run.



---



\### Metrics and Logs



\*\*Metrics\*\* (stored in metrics.json):

| Key | Type | Description |

|------|------|-------------|

| total\_cost | float | Final objective value |

| utilization | float | Σ(duration\_surgeries) / Σ(cost\_anesthetists) |

| runtime\_sec | float | Wall-clock solver time |

| num\_workers | int | Number of solver threads |

| num\_anesthetists | int | Number of active anesthesiologists |

| solver\_status | str | One of \[INFEASIBLE, FEASIBLE, OPTIMAL, UNKNOWN] |

| config\_hash | str | SHA256 of effective configuration |

| seed | int | Random seed used in the run |



\*\*Logs\*\* (stored in solver.log):

Each line formatted as:

\[timestamp] \[LEVEL] \[event\_message]



Example:

\[2025-10-30 14:31:04] INFO Solver started (workers=8, seed=42)

\[2025-10-30 14:31:25] INFO Status: FEASIBLE Objective=185.0 Runtime=21.6s

\[2025-10-30 14:31:31] INFO Status: OPTIMAL Objective=184.5





---



\### Summary

The Optimizer module finalizes the CP-SAT solving phase and returns a structured, reproducible summary of the optimization process.

It guarantees:

\- deterministic status and objective for identical inputs,

\- complete logging and metrics capture,

\- clear state transitions and error handling,

\- and integration readiness for MLOps experiment tracking.
