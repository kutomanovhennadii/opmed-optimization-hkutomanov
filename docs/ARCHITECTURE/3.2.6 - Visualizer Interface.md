\## 3.2.6 - Visualizer Interface (Wrapper for Client Visualization Code)



\### Purpose

The Visualizer module provides a standardized interface for rendering and exporting the daily surgical schedule.

It wraps the client-provided plotting code (`plot\_day\_schedule`) and ensures compliance with project-wide visualization standards.

The wrapper is responsible for configuration management, DPI and figure size enforcement, PNG export, and integration with validation and metrics pipelines.



---



\### Function Signature

plot\_schedule(assignments, surgeries, cfg, out\_path: Path) -> Path





\*\*Description:\*\*

This function serves as an adapter that:

1\. Calls the client-provided code block (`plot\_day\_schedule`) to render the visualization in memory.

2\. Applies global display parameters (figure size, DPI, tight layout).

3\. Saves the resulting figure to a PNG file at `out\_path`.

4\. Returns the absolute path to the saved file.



---



\### Contracts



\*\*Preconditions\*\*

\- `assignments` is a valid DataFrame or structure from SolveResult, containing columns:

&nbsp; `anesthetist\_id`, `room\_id`, `start\_time`, `end\_time`.

\- `surgeries` is provided for consistency checks and duration references.

\- `cfg.visual` contains at least:

&nbsp; - `dpi` (int, default 150)

&nbsp; - `size` (\[float, float], default \[19, 10])

&nbsp; - `show\_labels` (bool, default True)

\- `out\_path` points to an existing writable directory.



\*\*Postconditions\*\*

\- A PNG file is created and saved to `out\_path`.

\- File name convention: `solution\_plot.png` (or provided by caller).

\- Image contains:

&nbsp; - X-axis: time of day (hours or ticks)

&nbsp; - Y-axis: anesthetist identifiers

&nbsp; - Color palette: unique color per room\_id

&nbsp; - Legend: all active rooms with corresponding colors

&nbsp; - Title: total anesthetists displayed

\- DPI and size correspond to `cfg.visual` parameters.

\- Function returns `Path` to the saved file.

\- Function does not modify input data.



\*\*Errors\*\*

\- `VisualizationError`: raised if saving fails or rendering parameters are invalid.

\- `IOError`: raised if `out\_path` is not writable.

\- `DataError`: raised if input structure is missing required fields.



---



\### Wrapper Behavior

The wrapper guarantees:

\- consistent visual output across environments;

\- reproducible figure layout and scaling;

\- no side effects beyond file creation.



Workflow:

1\. Receive `assignments`, `cfg`, and output path.

2\. Invoke client visualization code (`plot\_day\_schedule(assignments)`).

3\. Apply parameters:



fig.savefig(out\_path, dpi=cfg.visual.dpi, bbox\_inches="tight")

plt.close()



4\. Return `Path(out\_path)`.



---



\### Integration

\- Executed \*\*after Validator\*\*, only if `validation\_report.valid == True`.

\- Output file path stored in `metrics.json` under key `"plot\_path"`.

\- PNG located in the run output directory:



data/output/run\_<timestamp>/solution\_plot.png



\- Visualizer errors are logged but non-blocking for CI/CD.



---



\### Summary

The Visualizer interface formalizes the use of the client-supplied plotting code within the Opmed system.

It enforces DPI, figure size, and output file guarantees, integrates with experiment metrics, and ensures

consistent, reproducible graphical output across all optimization runs.
