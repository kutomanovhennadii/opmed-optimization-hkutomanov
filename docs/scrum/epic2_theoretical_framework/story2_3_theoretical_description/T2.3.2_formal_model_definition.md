\# ğŸ§© T2.3.2 â€” Formal Definition of the Optimization Model



\## 1. Purpose

This section presents a \*\*complete formal definition\*\* of the Opmed anesthesiologist allocation optimization model.  

It consolidates all mathematical entities, relationships, and constraints into a unified formal structure consistent with CP-SATâ€™s mixed-integer, constraint-based paradigm.



---



\## 2. Model Description

We define the problem as a \*\*constrained combinatorial optimization model\*\*:



Minimize total anesthesiologist cost  

â€ƒsubject to temporal, resource, and feasibility constraints  

â€ƒwithin bounded shift durations and fixed surgery times.



Formally, the model is defined by a tuple:



\*\*M = (S, A, R, T, X, Y, Î¸, f, ğ“’)\*\*



where:

\- \*\*S\*\* â€” set of surgeries  

\- \*\*A\*\* â€” set of anesthesiologist shifts  

\- \*\*R\*\* â€” set of operating rooms  

\- \*\*T\*\* â€” continuous or discretized time domain  

\- \*\*X, Y\*\* â€” binary decision variables (assignments)  

\- \*\*Î¸\*\* â€” set of parameters and constants  

\- \*\*f\*\* â€” cost function  

\- \*\*ğ“’\*\* â€” constraint system  



---



\## 3. Sets and Domains



| Symbol | Domain | Meaning |

|---------|---------|---------|

| S = {1, â€¦, N} | finite | surgeries |

| A = {1, â€¦, M} | finite | anesthesiologists (shifts) |

| R = {1, â€¦, 20} | finite | operating rooms |

| T | â„âº or â„¤âº | time (continuous or discretized with step Î”t) |



---



\## 4. Parameters Î¸



| Parameter | Description | Default |

|------------|--------------|----------|

| SHIFT\_MIN | Minimum payable shift | 5 h |

| SHIFT\_MAX | Maximum allowable shift | 12 h |

| SHIFT\_OVERTIME | Overtime threshold | 9 h |

| OVERTIME\_MULTIPLIER | Overtime pay multiplier | 1.5 |

| BUFFER | Required room-change buffer | 0.25 h (15 min) |

| UTILIZATION\_TARGET | Target efficiency threshold | 0.8 |

| ROOMS\_MAX | Number of available rooms | 20 |

| TIME\_UNIT | Time discretization step | 1/12 h (5 min) |

| ALLOW\_LONG\_OPERATIONS | Boolean flag for surgeries > 12 h | False |



---



\## 5. Decision Variables



| Variable | Domain | Definition |

|-----------|---------|-------------|

| x\[s,a] âˆˆ {0,1} | Binary | 1 if anesthesiologist \*a\* assigned to surgery \*s\* |

| y\[s,r] âˆˆ {0,1} | Binary | 1 if surgery \*s\* is performed in room \*r\* |

| t\_start\[s], t\_end\[s] | Fixed (given) | Start and end time of surgery \*s\* |

| t\_min\[a], t\_max\[a] | Continuous/Integer | Start and end time of anesthesiologist shift \*a\* |

| duration\_a | Derived | t\_max\[a] âˆ’ t\_min\[a] |

| cost\[a] | Derived | Shift cost as function of duration\_a |

| active\[a] âˆˆ {0,1} | Binary | 1 if anesthesiologist \*a\* performs â‰¥1 surgery |



---



\## 6. Derived Quantities



1\. \*\*Duration of Shift:\*\*  

â€ƒduration\_a = t\_max\[a] âˆ’ t\_min\[a]



2\. \*\*Shift Cost Function:\*\*  

â€ƒcost\[a] = max(SHIFT\_MIN, duration\_a) + (OVERTIME\_MULTIPLIER âˆ’ 1) Ã— max(0, duration\_a âˆ’ SHIFT\_OVERTIME)



3\. \*\*Utilization:\*\*  

â€ƒU = Î£(duration\_surgeries) / Î£(cost(a))



4\. \*\*Objective Function (Total Cost):\*\*  

â€ƒC\_total = Î£(cost\[a])â€ƒfor all a âˆˆ A



Optional extended form (multi-objective):  

â€ƒMinimize Î± Î£(active\[a]) + Î² Î£(cost\[a])â€ƒwith Î± â‰« Î².



---



\## 7. Constraint System ğ“’



\### 7.1. Surgeryâ€“Room Assignment

Each surgery occupies exactly one room:

â€ƒâˆ€ s âˆˆ S: Î£â‚râˆˆRâ‚ y\[s,r] = 1



Room exclusivity (no overlap in same room):  

â€ƒâˆ€ r âˆˆ R, âˆ€ sâ‚ â‰  sâ‚‚:  

â€ƒIf \[startâ‚, endâ‚] âˆ© \[startâ‚‚, endâ‚‚] â‰  âˆ… â‡’ y\[sâ‚,r] + y\[sâ‚‚,r] â‰¤ 1



---



\### 7.2. Surgeryâ€“Anesthesiologist Assignment

Each surgery handled by one anesthesiologist:

â€ƒâˆ€ s âˆˆ S: Î£â‚aâˆˆAâ‚ x\[s,a] = 1



No overlaps per anesthesiologist:

â€ƒâˆ€ a âˆˆ A, âˆ€ sâ‚ â‰  sâ‚‚:  

â€ƒIf \[startâ‚, endâ‚] âˆ© \[startâ‚‚, endâ‚‚] â‰  âˆ… â‡’ x\[sâ‚,a] + x\[sâ‚‚,a] â‰¤ 1



---



\### 7.3. Temporal and Buffer Constraints

If anesthesiologist a performs surgeries sâ‚, sâ‚‚ and room(sâ‚) â‰  room(sâ‚‚):  

â€ƒstartâ‚‚ â‰¥ endâ‚ + BUFFER  

Conversely, if same room: BUFFER = 0.



---



\### 7.4. Shift Boundaries

t\_min\[a] = min(start\_s | x\[s,a]=1)  

t\_max\[a] = max(end\_s | x\[s,a]=1)



Shift duration constraints:  

â€ƒSHIFT\_MIN â‰¤ duration\_a â‰¤ SHIFT\_MAX



---



\### 7.5. Long Surgery Restriction

If ALLOW\_LONG\_OPERATIONS = False:  

â€ƒâˆ€ s âˆˆ S,â€ƒduration\_s â‰¤ SHIFT\_MAX



Otherwise, surgery s exceeding 12h must trigger split assignment in future model extension.



---



\### 7.6. Utilization Validity

Final schedule utilization must satisfy:  

â€ƒU = Î£(duration\_surgeries) / Î£(cost(a)) â‰¥ UTILIZATION\_TARGET



---



\### 7.7. Activation Logic

active\[a] = 1 â‡” Î£â‚sâˆˆSâ‚ x\[s,a] â‰¥ 1



---



\### 7.8. Integrality and Domain Conditions

x\[s,a], y\[s,r], active\[a] âˆˆ {0,1}  

t\_min\[a], t\_max\[a], duration\_a âˆˆ â„âº or â„¤âº depending on discretization  

All other parameters fixed and known a priori.



---



\## 8. Optimization Goal

Minimize total cost of anesthesiologist shifts while respecting all hard constraints.



Formal objective:

â€ƒ\*\*Minimize:\*\*â€ƒC\_total = Î£(cost\[a])



Subject to:

â€ƒâˆ€ (x,y,t\_min,t\_max,duration\_a,cost\[a]) satisfying ğ“’.



Secondary objectives (optional multi-objective mode):

â€ƒMinimize simultaneously {number of anesthesiologists, total cost, idle time},  

â€ƒsubject to U â‰¥ 0.8.



---



\## 9. Solver Realization (CP-SAT Mapping)



| CP-SAT Element | Corresponding Model Component |

|----------------|--------------------------------|

| BoolVar(x\[s,a]) | Surgeryâ€“anesthesiologist assignment |

| BoolVar(y\[s,r]) | Surgeryâ€“room assignment |

| IntVar(start\_s, end\_s) | Fixed intervals for surgeries |

| IntervalVar(start\_s, duration\_s, end\_s) | Surgery time segment |

| NoOverlap(intervals\_r) | Room exclusivity constraint |

| NoOverlap(intervals\_a) | Anesthesiologist exclusivity constraint |

| LinearExpr | Cost and duration computation |

| AddMaxEquality | Piecewise cost function enforcement |

| Minimize(sum(cost\[a])) | Objective function |



---



\## 10. Model Properties



| Property | Classification |

|-----------|----------------|

| Problem Type | Resource-constrained scheduling |

| Mathematical Nature | Mixed Integer, Piecewise Linear |

| Constraint Structure | Temporal + Resource + Logical |

| Objective Function | Nonlinear (piecewise) minimization |

| Complexity | Strongly NP-hard |

| Solution Method | CP-SAT (Constraint + SAT hybrid) |

| Relaxation Type | Lazy Clause Generation with LP bounds |

| Optimization Mode | Anytime search (approximate until cutoff) |



---



\## 11. Formal Model Summary

Minimize:

Î£(cost\[a])

Subject to:

âˆ€ s âˆˆ S: Î£â‚râˆˆRâ‚ y\[s,r] = 1

âˆ€ s âˆˆ S: Î£â‚aâˆˆAâ‚ x\[s,a] = 1

âˆ€ r âˆˆ R: NoOverlap({interval\_s | y\[s,r]=1})

âˆ€ a âˆˆ A: NoOverlap({interval\_s | x\[s,a]=1})

âˆ€ (sâ‚,sâ‚‚,a): if room(sâ‚) â‰  room(sâ‚‚) then startâ‚‚ â‰¥ endâ‚ + BUFFER

âˆ€ a âˆˆ A: SHIFT\_MIN â‰¤ duration\_a â‰¤ SHIFT\_MAX

âˆ€ s âˆˆ S: duration\_s â‰¤ SHIFT\_MAX (if ALLOW\_LONG\_OPERATIONS=False)

U = Î£(duration\_s) / Î£(cost(a)) â‰¥ 0.8

Variables:

x\[s,a], y\[s,r], active\[a] âˆˆ {0,1}

t\_min\[a], t\_max\[a], duration\_a âˆˆ â„âº



The defined model constitutes a complete mathematical specification of the anesthesiologist scheduling optimization system.  

It captures all essential resource, time, and cost relationships while remaining fully compatible with the CP-SAT solverâ€™s mixed-integer constraint architecture.  

This formulation serves as the foundation for implementation in Python/OR-Tools and subsequent hybrid optimization strategies defined in Epic 3â€“4.



---



\*\*Status:\*\* Formal model finalized  

\*\*Dependencies:\*\* T2.3.1 (formula summary), T2.2.5 (hybrid guidelines)  



