\# üìò Theoretical\_Model.md ‚Äî Opmed Anesthesiologist Allocation Optimization Framework



\## 1. Introduction

This document consolidates the full theoretical framework of the \*\*Opmed anesthesiologist allocation problem\*\*, developed throughout Epics 1‚Äì2.  

It presents the unified mathematical formulation, assumptions, constraints, objective functions, validation protocol, and proposed future extensions.  

The model is implemented via \*\*Google OR-Tools CP-SAT\*\*, representing a modern hybrid of constraint programming, SAT reasoning, and integer optimization.



---



\## 2. Problem Definition

Given a set of scheduled surgeries ‚Äî each requiring one anesthesiologist and one operating room ‚Äî determine the most cost-efficient allocation that satisfies all timing, capacity, and shift-duration constraints.



\### 2.1. Entities

\- \*\*Surgeries (S):\*\* fixed intervals defined by known start and end times.  

\- \*\*Anesthesiologists (A):\*\* agents performing one or more surgeries sequentially.  

\- \*\*Operating Rooms (R):\*\* finite resource pool of 20 rooms.  

\- \*\*Time (T):\*\* continuous but discretized domain (default Œît = 5 minutes).  



\### 2.2. Constraints

1\. Each surgery is assigned to exactly one anesthesiologist and one room.  

2\. No overlaps are allowed within the same room or for the same anesthesiologist.  

3\. If an anesthesiologist switches rooms, a \*\*15-minute buffer\*\* must be respected.  

4\. Shifts must be between \*\*5 and 12 hours\*\*.  

5\. \*\*Overtime\*\* (beyond 9 hours) is paid at \*\*1.5√ó\*\* rate.  

6\. All surgeries must be covered without exceeding room or shift limits.  

7\. Target utilization: \*\*U ‚â• 0.8\*\* (80% efficiency).



---



\## 3. Mathematical Model



\### 3.1. Decision Variables

| Variable | Type | Description |

|-----------|------|-------------|

| x\[s,a] | Binary | 1 if anesthesiologist a assigned to surgery s |

| y\[s,r] | Binary | 1 if surgery s assigned to room r |

| t\_min\[a], t\_max\[a] | Real | Start and end times of anesthesiologist a‚Äôs shift |

| duration\_a | Derived | t\_max\[a] ‚àí t\_min\[a] |

| cost\[a] | Derived | Total cost of shift a |

| active\[a] | Binary | 1 if a performs ‚â•1 surgery |



\### 3.2. Parameters

| Parameter | Value | Meaning |

|------------|--------|----------|

| ROOMS\_MAX | 20 | Available operating rooms |

| SHIFT\_MIN | 5 h | Minimum paid shift |

| SHIFT\_MAX | 12 h | Maximum allowed shift |

| SHIFT\_OVERTIME | 9 h | Overtime threshold |

| OVERTIME\_MULTIPLIER | 1.5 | Overtime coefficient |

| BUFFER | 0.25 h | Room-change time |

| TIME\_UNIT | 1/12 h | 5-minute discretization |

| UTILIZATION\_TARGET | 0.8 | Minimum efficiency |

| ALLOW\_LONG\_OPERATIONS | False | Flag for >12h surgeries |



\### 3.3. Constraints (ùìí)

1\. \*\*Surgery-room assignment:\*\* Œ£‚Ççr‚ààR‚Çé y\[s,r] = 1.  

2\. \*\*Room exclusivity:\*\* If surgeries overlap ‚Üí y\[s‚ÇÅ,r] + y\[s‚ÇÇ,r] ‚â§ 1.  

3\. \*\*Surgery-anesthesiologist assignment:\*\* Œ£‚Çça‚ààA‚Çé x\[s,a] = 1.  

4\. \*\*Anesthesiologist exclusivity:\*\* If overlaps ‚Üí x\[s‚ÇÅ,a] + x\[s‚ÇÇ,a] ‚â§ 1.  

5\. \*\*Buffer rule:\*\* For room(s‚ÇÅ) ‚â† room(s‚ÇÇ): start‚ÇÇ ‚â• end‚ÇÅ + BUFFER.  

6\. \*\*Shift duration:\*\* SHIFT\_MIN ‚â§ duration\_a ‚â§ SHIFT\_MAX.  

7\. \*\*Cost function:\*\*  

&nbsp;  cost\[a] = max(SHIFT\_MIN, duration\_a) + 0.5√ómax(0, duration\_a ‚àí 9).  

8\. \*\*Utilization threshold:\*\* U = Œ£(duration\_s) / Œ£(cost\[a]) ‚â• 0.8.



\### 3.4. Objective

Minimize total anesthesiologist cost:

‚ÄÉ\*\*Minimize:\*\* C\_total = Œ£(cost\[a])  

Optional: Minimize Œ± Œ£(active\[a]) + Œ≤ Œ£(cost\[a]) with Œ± ‚â´ Œ≤.



---



\## 4. Solver Mapping (CP-SAT)

| Model Component | CP-SAT Feature |

|-----------------|----------------|

| Assignments | BoolVar(x, y) |

| Time intervals | IntervalVar(start, duration, end) |

| No-overlap logic | `NoOverlap()` constraints |

| Piecewise cost | `AddMaxEquality()` |

| Feasibility enforcement | Propagation via CDCL and LCG |

| Optimization | `model.Minimize(sum(cost\[a]))` |



The CP-SAT engine uses \*\*Lazy Clause Generation\*\*, integrating SAT conflict learning, CP propagation, and LP relaxations.  

Parallel workers explore diverse search strategies and exchange learned bounds.



---



\## 5. Theoretical Properties

| Property | Value |

|-----------|--------|

| Problem type | Resource-constrained scheduling |

| Complexity | Strongly NP-hard |

| Objective | Piecewise-linear minimization |

| Constraint type | Temporal + logical + resource |

| Solver | OR-Tools CP-SAT (portfolio mode) |

| Optimization mode | Anytime search |

| Optimality | Guaranteed if solved to completion |

| Feasibility | Ensured through propagation |



---



\## 6. Validation Framework



\### 6.1. Feasibility Criteria

A schedule is valid if:

1\. All surgeries have exactly one anesthesiologist and one room.  

2\. No overlaps violate NoOverlap or BUFFER constraints.  

3\. Shift durations remain within \[5h, 12h].  

4\. Cost function matches duration formula.  

5\. U ‚â• 0.8 (80% utilization).



\### 6.2. Validation Artifacts

\- \*\*validation\_report.json:\*\* constraint-level compliance results.  

\- \*\*metrics\_summary.csv:\*\* cost, utilization, runtime.  

\- \*\*violations.log:\*\* all infeasibility traces.



\### 6.3. Stability

\- Discretization error ‚â§ 1%.  

\- Cost and utilization vary smoothly under parameter perturbation.  

\- Integer encoding ensures deterministic reproducibility.



---



\## 7. Model Validity and Stability



\### 7.1. Logical Consistency

All constraints are monotonic and non-conflicting ‚Äî the system remains feasible when Œ£(duration\_s) ‚â§ ROOMS\_MAX √ó SHIFT\_MAX.



\### 7.2. Sensitivity

Small perturbations in parameters (BUFFER, cost multipliers, time rounding) cause continuous and predictable variations in cost and utilization.



\### 7.3. Numerical Behavior

Integer-scaling (1/Œît) eliminates floating-point drift.  

Piecewise-linear cost is convex and stable.  

Propagation converges deterministically.



\### 7.4. Overall Assessment

| Aspect | Result |

|--------|--------|

| Feasibility | ‚úÖ Stable |

| Numerical conditioning | ‚úÖ Robust |

| Sensitivity | ‚úÖ Low |

| Solver determinism | ‚úÖ Reproducible |



---



\## 8. Future Extensions



\### 8.1. Multi-Day Scheduling

\- Add daily index d ‚àà D.  

\- Inter-day rest constraints and weekly hour limits.  

\- Solved by decomposition or rolling horizon.



\### 8.2. Handover Protocols

\- Allow multi-anesthesiologist coverage per surgery.  

\- Introduce handover variable z\[a‚ÇÅ,a‚ÇÇ,s].  

\- Add buffer overlap and handover penalties.



\### 8.3. Stochastic Optimization

\- Duration and start times as random variables.  

\- Scenario-based or robust optimization ensuring 95% feasibility.  

\- Expected-cost minimization.



\### 8.4. Multi-Objective Optimization

\- Combine cost, fairness, and robustness metrics:

&nbsp; F = \[C\_total, Fairness, Robustness, U‚Åª¬π].  

\- Use Pareto or lexicographic optimization.



\### 8.5. Learning-Enhanced Solving

\- Adaptive tuning of CP-SAT hyperparameters via MLflow or Optuna.  

\- Reinforcement learning for branching priorities.  

\- Continuous retraining from real hospital data.



---



\## 9. Implementation Summary



| Layer | Component | Purpose |

|-------|------------|----------|

| \*\*Model\*\* | Formal mathematical specification | Defines variables, constraints, objective |

| \*\*Solver\*\* | CP-SAT | Exact, hybrid combinatorial solver |

| \*\*Validation\*\* | Rule-based checker | Confirms feasibility and efficiency |

| \*\*MLOps\*\* | Airflow + MLflow | Tracks tuning experiments |

| \*\*Hybrid Enhancements\*\* | CP-SAT + LNS | Runtime and quality optimization |

| \*\*Future Extensions\*\* | Multi-day, stochastic, learning-based | Scalability and realism |



---



\## 10. Conclusion

The Opmed anesthesiologist allocation model represents a \*\*rigorous and extensible optimization framework\*\* grounded in combinatorial mathematics and hybrid reasoning.  

It provides:

\- A logically sound constraint system,  

\- A convex piecewise cost structure,  

\- Deterministic and reproducible solutions via CP-SAT,  

\- And a clear roadmap for future research and deployment.



This theoretical foundation ensures that subsequent development (Epics 3‚Äì9) can proceed with confidence in the mathematical integrity and stability of the system.



---



\*\*Document:\*\* `Theoretical\_Model.md`  

\*\*Compiled from:\*\* T2.1.1‚ÄìT2.3.4  

\*\*Maintainers:\*\* Algorithm Research Team, Opmed Optimization Project  

\*\*Version:\*\* 1.0 (Theoretical Baseline)



