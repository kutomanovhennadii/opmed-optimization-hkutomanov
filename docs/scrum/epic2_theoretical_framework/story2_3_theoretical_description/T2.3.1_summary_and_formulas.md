\# 🧩 T2.3.1 — Summary of All Formulas, Assumptions, and Derivations



\## 1. Purpose

To consolidate all key \*\*mathematical formulations\*\*, \*\*assumptions\*\*, and \*\*derivations\*\* developed throughout Epics 1–2 into a single theoretical reference.

This section serves as the formal specification of the Opmed anesthesiologist allocation problem before implementation in OR-Tools.



---



\## 2. Sets and Indices



| Symbol | Description |

|---------|-------------|

| \*\*S\*\* = {1, …, N} | Set of surgeries |

| \*\*A\*\* = {1, …, M} | Set of anesthesiologist shifts (potentially unlimited) |

| \*\*R\*\* = {1, …, 20} | Set of operating rooms |

| \*\*TIME\_UNIT = Δt\*\* | Discretization step (default 5 min = 1/12 h) |



---



\## 3. Variables



| Variable | Type | Description |

|-----------|------|-------------|

| \*\*x\[s,a] ∈ {0,1}\*\* | Binary | 1 if anesthesiologist \*a\* assigned to surgery \*s\* |

| \*\*y\[s,r] ∈ {0,1}\*\* | Binary | 1 if surgery \*s\* is performed in room \*r\* |

| \*\*t\_start\[s]\*\*, \*\*t\_end\[s]\*\* | Continuous / integer | Fixed surgery start and end times |

| \*\*t\_min\[a]\*\*, \*\*t\_max\[a]\*\* | Continuous / integer | Start / end time of anesthesiologist \*a\*’s shift |

| \*\*duration\_a = t\_max\[a] − t\_min\[a]\*\* | Derived | Duration of shift \*a\* |

| \*\*cost\[a]\*\* | Real | Total cost of shift \*a\* |

| \*\*U\*\* | Real | Utilization metric (efficiency of schedule) |



---



\## 4. Parameters and Constants



| Parameter | Meaning | Default Value |

|------------|----------|----------------|

| \*\*ROOMS\_MAX\*\* | Number of operating rooms | 20 |

| \*\*SHIFT\_MIN\*\* | Minimum payable shift | 5 h |

| \*\*SHIFT\_MAX\*\* | Maximum allowable shift | 12 h |

| \*\*SHIFT\_OVERTIME\*\* | Overtime threshold | 9 h |

| \*\*OVERTIME\_MULTIPLIER\*\* | Overtime pay multiplier | 1.5× |

| \*\*BUFFER\*\* | Transition time between rooms | 15 min = 0.25 h |

| \*\*UTILIZATION\_TARGET\*\* | Efficiency target | 0.8 |

| \*\*ALLOW\_LONG\_OPERATIONS\*\* | Boolean flag (extension placeholder) | False |



---



\## 5. Fundamental Constraints



\### 5.1. Surgery–Room Assignment

Each surgery uses exactly one room:

 ∀ s ∈ S: Σ₍r∈R₎ y\[s,r] = 1.



Each room can host at most one surgery at a time:

 If intervals \[s₁,s₂] overlap → y\[s₁,r] + y\[s₂,r] ≤ 1 for all r.



\### 5.2. Surgery–Anesthesiologist Assignment

Each surgery is attended by exactly one anesthesiologist:

 ∀ s ∈ S: Σ₍a∈A₎ x\[s,a] = 1.



No anesthesiologist can perform overlapping surgeries:

 If intervals \[s₁,s₂] overlap → x\[s₁,a] + x\[s₂,a] ≤ 1.



\### 5.3. Buffer Between Rooms

If anesthesiologist \*a\* moves between different rooms:

 start₂ ≥ end₁ + BUFFER.

If within the same room, BUFFER = 0.



\### 5.4. Shift Duration and Validity

t\_min\[a] = min(start\_s), t\_max\[a] = max(end\_s) for surgeries assigned to \*a\*.

Shift bounds: SHIFT\_MIN ≤ duration\_a ≤ SHIFT\_MAX.

If ALLOW\_LONG\_OPERATIONS = False, all surgeries satisfy duration\_s ≤ SHIFT\_MAX.



\### 5.5. Cost Function

Each anesthesiologist’s cost:



 cost\[a] = max(SHIFT\_MIN, duration\_a) + (OVERTIME\_MULTIPLIER − 1) × max(0, duration\_a − SHIFT\_OVERTIME)



The formula ensures minimum pay of 5 hours and overtime compensation beyond 9 hours.



\### 5.6. Utilization

 U = Σ(duration\_surgeries) / Σ(cost(anesthesiologists))



A valid and efficient schedule requires U ≥ UTILIZATION\_TARGET = 0.8.



---



\## 6. Objective Function



Minimize total anesthesiologist cost:



 \*\*C\_total = Σ(cost\[a]) for a ∈ A\*\*



Optionally, for hybrid models:



 \*\*Total\_Objective = α Σ(active\[a]) + β Σ(cost\[a])\*\*,

where active\[a] = 1 if a is assigned at least one surgery.



Typical choice: α ≫ β to prioritize reducing total personnel count.



---



\## 7. Discretization and Approximation



Time variables can be represented as integer multiples of Δt = TIME\_UNIT.

Rounding rules:

\- Start times → floor

\- End times → ceil

This guarantees schedule feasibility even with discretization noise ≤ Δt / 2.



Approximation error bounds:

\- |duration − duration′| ≤ Δt / 2

\- |U − U′| ≤ (N × Δt) / Σ(cost) ≈ 1 % (for Δt = 5 min)



---



\## 8. Theoretical Complexity



\- Subproblems (room allocation, anesthesiologist scheduling) are NP-hard.

\- Combined formulation → \*\*strongly NP-hard\*\*.

\- Solved using CP-SAT (Constraint Programming + SAT hybrid) with portfolio parallelism.

\- Time-bounded anytime optimization provides best-known feasible solution within max\_time\_in\_seconds.



---



\## 9. Solver Parameters (Typical Defaults)



| Parameter | Default | Function |

|------------|----------|-----------|

| `max\_time\_in\_seconds` | 300 | Limits total runtime |

| `num\_search\_workers` | 8 | Parallel worker threads |

| `search\_branching` | AUTOMATIC | Adaptive branching policy |

| `linearization\_level` | 1 | Moderate LP relaxation |

| `random\_seed` | 42 | Reproducibility |

| `cp\_model\_presolve` | True | Constraint simplification |



---



\## 10. Validation Criteria

A schedule is \*\*valid\*\* iff:

1\. Every surgery has one anesthesiologist and one room.

2\. No overlaps or buffer violations exist.

3\. Shift durations respect \[SHIFT\_MIN, SHIFT\_MAX].

4\. Cost formula and utilization are consistent.

5\. U ≥ 0.8 or flagged “conditionally valid.”



Validation artifacts:

\- `validation\_report.json` — per-constraint check results.

\- `metrics\_summary.csv` — cost, utilization, runtime.

\- `violations.log` — detailed infeasibility trace.



---



\## 11. Assumptions Summary



| Category | Assumption |

|-----------|-------------|

| Time | Continuous but discretized at Δt = 5 min |

| Staffing | Pool of anesthesiologists unlimited; each shift unique |

| Surgery Times | Fixed start and end times (non-optimizable) |

| Buffers | Required only across distinct rooms |

| Cost Model | Piecewise-linear, based on shift length |

| Long Surgeries | >12 h disallowed (can be extended in future models) |

| Optimality | Minimum total cost under valid constraints |

| Efficiency | Schedules with U ≥ 0.8 considered acceptable |



---



\## 12. Derived Relationships



1\. `duration\_a` = max(end\_s | x\[s,a]=1) − min(start\_s | x\[s,a]=1)`

2\. `total\_cost` = Σ(cost\[a])

3\. `num\_active\_a` = Σ(active\[a])

4\. `utilization` = Σ(duration\_s) / Σ(cost\[a])

5\. `efficiency\_gain` = (utilization − 0.8) × 100 %



---



\## 13. Analytical Summary



The model constitutes a \*\*mixed-integer, resource-constrained scheduling optimization\*\* formulated as:



Minimize:

 Σ(cost\[a])



Subject to:

 Room, anesthesiologist, and buffer constraints,

 Shift bounds and cost definitions,

 All time variables discretized with Δt ≤ BUFFER/3.



The solution space is explored via \*\*CP-SAT portfolio search\*\*, optionally enhanced with \*\*LNS hybrid refinement\*\*, with results validated against theoretical feasibility and efficiency criteria.



---



\*\*Status:\*\* Consolidation complete

\*\*Dependencies:\*\* Epics 1–2 (T1.1.1 – T2.2.5)
